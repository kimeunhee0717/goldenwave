(function(){"use strict";const N=[[0,1],[1,0],[1,1],[1,-1]],s=[];for(let e=0;e<15;e++)s.push(new Array(15).fill(null));function C(e){for(let t=0;t<15;t++)for(let o=0;o<15;o++)s[t][o]=e[t][o]}function h(e,t){return e>=0&&e<15&&t>=0&&t<15}function g(e,t,o){if(!o)return!1;for(const[f,r]of N){let c=1;for(const l of[1,-1]){let i=e+f*l,w=t+r*l;for(;h(i,w)&&s[i][w]===o;)c++,i+=f*l,w+=r*l}if(o==="white"?c>=5:c===5)return!0}return!1}function D(e,t,o,f,r){let c=1,l=0;for(const i of[1,-1]){let w=e+o*i,a=t+f*i;for(;h(w,a)&&s[w][a]===r;)c++,w+=o*i,a+=f*i;h(w,a)&&s[w][a]===null&&l++}return[c,l]}function O(e,t,o,f,r){const c=[[e,t]];for(const u of[1,-1]){let n=e+o*u,k=t+f*u;for(;h(n,k)&&s[n][k]===r;)c.push([n,k]),n+=o*u,k+=f*u}if(c.length!==3)return!1;c.sort((u,n)=>(u[0]-n[0])*o+(u[1]-n[1])*f);const[l,i]=c[0],[w,a]=c[2];return h(l-o,i-f)&&s[l-o][i-f]===null&&h(w+o,a+f)&&s[w+o][a+f]===null}function I(e,t,o){if(s[e][t]!==null)return!1;s[e][t]=o;let f=!0;for(const[r,c]of N){let l=1;for(const i of[1,-1]){let w=e+r*i,a=t+c*i;for(;h(w,a)&&s[w][a]===o;)l++,w+=r*i,a+=c*i}if(l>5){f=!1;break}}if(f){let r=0;for(const[c,l]of N)O(e,t,c,l,o)&&r++;r>=2&&(f=!1)}if(f){let r=0;for(const[c,l]of N)D(e,t,c,l,o)[0]===4&&r++;r>=2&&(f=!1)}return s[e][t]=null,f}function B(e,t){return e>=5?1e5:e===4?t===2?5e4:t===1?1e4:0:e===3?t===2?5e3:t===1?500:0:e===2?t===2?200:t===1?20:0:e===1&&t===2?5:0}function L(e,t){let o=0,f=0;for(let r=0;r<15;r++)for(let c=0;c<15;c++){const l=s[r][c];if(l)for(const[i,w]of N){if(h(r-i,c-w)&&s[r-i][c-w]===l)continue;let a=0,u=r,n=c;for(;h(u,n)&&s[u][n]===l;)a++,u+=i,n+=w;let k=0;h(u,n)&&s[u][n]===null&&k++,h(r-i,c-w)&&s[r-i][c-w]===null&&k++;const d=B(a,k);l===e?o+=d:f+=d}}return o-f}function M(e,t,o,f){let r=0;if(s[e][t]=o,g(e,t,o))return s[e][t]=null,1e7;for(const[l,i]of N)r+=B(...D(e,t,l,i,o));s[e][t]=null;let c=0;if(s[e][t]=f,g(e,t,f))return s[e][t]=null,5e6;for(const[l,i]of N)c+=B(...D(e,t,l,i,f));return s[e][t]=null,r+c*.9+(14-Math.abs(e-7)-Math.abs(t-7))*8}function T(e){const t=new Set;for(let o=0;o<15;o++)for(let f=0;f<15;f++)if(s[o][f]!==null)for(let r=-e;r<=e;r++)for(let c=-e;c<=e;c++){const l=o+r,i=f+c;h(l,i)&&s[l][i]===null&&t.add(l*15+i)}return t.size===0?[{row:7,col:7}]:Array.from(t).map(o=>({row:Math.floor(o/15),col:o%15}))}let x=0,v=!1;function A(e,t,o,f,r,c){if(Date.now()>x)return v=!0,0;if(e<=0)return L(r);const l=f?r:c,i=T(2).filter(a=>l!=="black"||I(a.row,a.col,"black")).map(a=>({...a,q:M(a.row,a.col,r,c)})).sort((a,u)=>u.q-a.q).slice(0,12);if(i.length===0)return L(r);const w=e>=6?8:e>=4?10:12;if(i.length>w&&(i.length=w),f){let a=-1/0;for(const u of i){if(s[u.row][u.col]=l,g(u.row,u.col,l))return s[u.row][u.col]=null,9999999;const n=A(e-1,t,o,!1,r,c);if(s[u.row][u.col]=null,v)return 0;if(n>a&&(a=n),n>t&&(t=n),t>=o)break}return a}else{let a=1/0;for(const u of i){if(s[u.row][u.col]=l,g(u.row,u.col,l))return s[u.row][u.col]=null,-9999999;const n=A(e-1,t,o,!0,r,c);if(s[u.row][u.col]=null,v)return 0;if(n<a&&(a=n),n<o&&(o=n),t>=o)break}return a}}function P(e,t,o){C(e);const f=o==="black"?"white":"black";if(!e.some(n=>n.some(k=>k!==null)))return{row:7,col:7};const r=T(2);for(const n of r){if(o==="black"&&!I(n.row,n.col,"black"))continue;s[n.row][n.col]=o;const k=g(n.row,n.col,o);if(s[n.row][n.col]=null,k)return n}for(const n of r){s[n.row][n.col]=f;const k=g(n.row,n.col,f);if(s[n.row][n.col]=null,k){if(o==="black"&&!I(n.row,n.col,"black"))continue;return n}}if(t===1){let n=-1/0,k=r[0];for(const d of r){if(o==="black"&&!I(d.row,d.col,"black"))continue;const q=M(d.row,d.col,o,f);q>n&&(n=q,k=d)}return k}const l=r.filter(n=>o!=="black"||I(n.row,n.col,"black")).map(n=>({...n,q:M(n.row,n.col,o,f)})).sort((n,k)=>k.q-n.q).slice(0,15);if(l.length===0)return r[0];const i=Date.now(),w=t===2?1e3:3e3,a=t===2?4:10;let u=l[0];for(let n=2;n<=a&&!(Date.now()-i>w-300);n+=2){v=!1,x=i+w;const k=l.findIndex(b=>b.row===u.row&&b.col===u.col);if(k>0){const b=l[0];l[0]=l[k],l[k]=b}let d=l[0],q=-1/0;for(const b of l){if(Date.now()>x)break;if(s[b.row][b.col]=o,g(b.row,b.col,o))return s[b.row][b.col]=null,b;const z=A(n-1,-1/0,1/0,!1,o,f);if(s[b.row][b.col]=null,v)break;z>q&&(q=z,d=b)}v||(u=d)}return u}self.onmessage=e=>{const{board:t,difficulty:o,myStone:f}=e.data;self.postMessage({move:P(t,o,f)})}})();
