# 2026-02-19 작업 리스트

## 개요
- **작업일:** 2026년 2월 19일
- **주요 작업:** AdSense 프리렌더링 문제 해결, Admin 포스팅 시스템 개선, 카테고리 구조 간소화, 이미지 업로드 기능 추가

---

## 1. AdSense 프리렌더링 문제 해결

### 문제 상황
- Google AdSense에서 "콘텐츠 없음" 경고 발생
- 원인: Vercel에서 puppeteer를 실행할 수 없어 SSG 프리렌더링이 작동하지 않음
- SPA(Single Page Application)는 JavaScript 실행 전까지 빈 HTML만 보여줌

### 해결 방법
1. **puppeteer 설치 확인**
   ```bash
   npm install puppeteer
   ```

2. **dist 폴더를 git에 포함**
   - `.gitignore`에서 `dist/` 제거
   - 로컬에서 빌드 후 프리렌더된 HTML을 직접 커밋

3. **Vercel 설정 변경**
   - `vercel.json` 수정: 빌드 건너뛰고 dist 폴더 직접 서빙
   ```json
   {
     "buildCommand": "",
     "outputDirectory": "dist"
   }
   ```

4. **배포 흐름 변경**
   - 기존: Vercel에서 빌드 → 실패 (puppeteer 못 씀)
   - 변경: 로컬 빌드 → dist 커밋 → Vercel은 dist만 서빙

### 관련 파일
- `package.json` - puppeteer 의존성 추가
- `.gitignore` - dist 폴더 제외 해제
- `vercel.json` - 빌드 설정 변경
- `docs/adsense-checklist.md` - 체크리스트 문서 생성

### 커밋
- `5d02d68` - Fix SSG prerender: add puppeteer dependency and adsense checklist
- `52dc1ef` - chore: dist 폴더 gitignore 제외 및 프리렌더된 HTML 추가
- `64bd45f` - chore: Vercel 설정 - 빌드 건너뛰고 dist 폴더 직접 서빙

---

## 2. Admin 포스팅 시스템 3단계 분리

### 변경 전
- 저장 + 배포가 한 번에 이루어짐
- 실수로 미완성 글이 바로 배포될 위험

### 변경 후: 3단계 워크플로우

#### Step 1: 저장 (Save)
- **버튼:** "저장"
- **동작:**
  - `src/data/posts.json`에 메타데이터 추가
  - `content/{category}/{slug}.md` 마크다운 파일 생성
- **API:** `POST /api/post`

#### Step 2: 발행 (Build)
- **버튼:** "발행"
- **동작:**
  - `npm run build` 실행
  - dist 폴더에 프리렌더된 index.html 생성
- **API:** `POST /api/build`
- **조건:** 저장 완료 후 활성화

#### Step 3: 배포 (Deploy)
- **버튼:** "배포"
- **동작:**
  - `git add .`
  - `git commit -m "Add blog post: {title}"`
  - `git push`
- **API:** `POST /api/deploy`
- **조건:** 발행 완료 후 활성화

### UI 변경사항
- 버튼 3개로 분리 (회색 저장 → 파란 발행 → 노란 배포)
- 순차적 활성화 (이전 단계 완료 전까지 다음 버튼 비활성화)
- 각 단계별 상태 표시 (로딩/성공/에러)

### 관련 파일
- `local-api.cjs` - `/api/build`, `/api/deploy` 엔드포인트 추가
- `src/pages/admin/NewPostPage.tsx` - UI 3단계 분리

### 커밋
- `04dacf5` - feat: Admin 포스트 저장/발행/배포 3단계 분리

---

## 3. 카테고리 구조 간소화

### 변경 전 (7개 카테고리)
| ID | 이름 | 글 수 |
|----|------|-------|
| ai-money | AI 머니 | - |
| digital-skill | 디지털스킬 | - |
| finance | 재테크 | - |
| side-hustle | 부업·N잡 | - |
| business | 비즈니스 | - |
| mindset | 부자마인드 | 6개 |
| briefing | 브리핑 | 4개 |

### 변경 후 (5개 카테고리)
| ID | 이름 | 통합된 카테고리 | 글 수 |
|----|------|-----------------|-------|
| digital-life | 디지털 생활 | ai-money + digital-skill | 131개 |
| money-plus | 머니플러스 | finance + side-hustle + business | 25개 |
| mindset | 부자마인드 | (유지) | 6개 |
| briefing | 브리핑 | (유지) | 4개 |
| draft | 편집중 | (신규) | 0개 |

### 작업 내용
1. `src/data/categories.json` 수정
2. `src/data/posts.json`의 모든 categoryId 업데이트
   - `ai-money` → `digital-life`
   - `digital-skill` → `digital-life`
   - `finance` → `money-plus`
   - `side-hustle` → `money-plus`
   - `business` → `money-plus`
3. 마크다운 파일 폴더 이동
   - `content/ai-money/*` → `content/digital-life/`
   - `content/digital-skill/*` → `content/digital-life/`
   - `content/finance/*` → `content/money-plus/`
   - `content/side-hustle/*` → `content/money-plus/`
   - `content/business/*` → `content/money-plus/`
4. 새 빈 폴더 생성: `content/draft/`

### 관련 파일
- `src/data/categories.json` - 카테고리 목록 변경
- `src/data/posts.json` - 166개 포스트의 categoryId 변경
- `content/` 폴더 구조 변경

### 커밋
- `af7c1c9` - refactor: 카테고리 구조 간소화

---

## 4. 헤더 메뉴 간소화 및 카테고리 탭 수정

### Navbar.tsx 변경사항

#### 변경 전
- 드롭다운 메뉴: AI 머니, 재테크, 디지털스킬, 부업·N잡, 비즈니스, 부자마인드
- 전체 뉴스 링크
- 뉴스레터 구독 버튼

#### 변경 후
- 드롭다운 메뉴 **삭제**
- 전체 뉴스 링크 (유지)
- 뉴스레터 구독 버튼 (유지)

### CategoryTabs.tsx 변경사항

#### 추가된 항목
- "유용한 도구" 링크 (`/tools`)
- Wrench 아이콘 사용 (lucide-react)
- 카테고리 탭 마지막에 위치

### 관련 파일
- `src/components/layout/Navbar.tsx` - menuItems 배열 삭제, 단순화
- `src/components/home/CategoryTabs.tsx` - "유용한 도구" 링크 추가

### 커밋
- `e24fa8e` - feat: 이미지 업로드 기능 및 UI 개선 (이 커밋에 포함)

---

## 5. 이미지 업로드 기능 추가

### 기능 설명
Admin 포스트 작성 페이지(`/admin/new`)에서 이미지를 쉽게 삽입할 수 있는 기능

### 지원하는 업로드 방식
1. **드래그 앤 드롭** - 이미지를 에디터 영역에 끌어다 놓기
2. **파일 선택** - "이미지 추가" 버튼 클릭 후 파일 선택

### 동작 흐름
```
1. 사용자가 이미지 파일 선택 (드래그 또는 버튼)
2. 파일을 Base64로 인코딩
3. POST /api/upload-image 호출
4. 서버에서 public/images/posts/에 파일 저장
5. 저장된 URL 반환 (/images/posts/timestamp-random.jpg)
6. 마크다운 문법으로 커서 위치에 자동 삽입
   ![파일명](/images/posts/timestamp-random.jpg)
```

### UI 요소
- **이미지 추가 버튼** - 에디터 툴바에 노란색 버튼
- **드래그 오버레이** - 이미지 드래그 시 안내 UI 표시
- **업로드 중 오버레이** - 업로드 진행 중 로딩 표시

### 제한사항
- 이미지 파일만 허용 (`image/*`)
- 최대 파일 크기: 10MB

### API 엔드포인트

#### POST /api/upload-image
**요청:**
```json
{
  "image": "base64인코딩된이미지",
  "filename": "원본파일명.jpg",
  "slug": "포스트슬러그"
}
```

**응답:**
```json
{
  "success": true,
  "url": "/images/posts/1708300000000-abc123.jpg",
  "filename": "1708300000000-abc123.jpg"
}
```

### 관련 파일
- `local-api.cjs`
  - `IMAGES_DIR` 상수 추가
  - `generateImageFilename()` 함수 추가
  - `POST /api/upload-image` 엔드포인트 추가
- `src/pages/admin/NewPostPage.tsx`
  - `useRef` import 추가 (textareaRef, fileInputRef)
  - `ImagePlus` 아이콘 import
  - `uploading`, `isDragging` 상태 추가
  - `fileToBase64()` 함수 추가
  - `uploadImage()` 함수 추가
  - `handleFileSelect()` 핸들러 추가
  - `handleDragOver()`, `handleDragLeave()`, `handleDrop()` 핸들러 추가
  - 에디터 툴바 UI 변경 (이미지 추가 버튼)
  - 드래그 오버레이, 업로드 중 오버레이 UI 추가

### 커밋
- `e24fa8e` - feat: 이미지 업로드 기능 및 UI 개선

---

## 6. CLAUDE.md 규칙 추가

### 추가된 규칙
```markdown
## 서버 실행 규칙
- localhost 링크를 안내할 때는 반드시 서버를 먼저 켜고 안내할 것
- 서버 실행 명령어 먼저 → 서버 구동 확인 → URL 안내 순서로 진행
```

### 이유
- 서버가 꺼진 상태에서 localhost 링크 안내 시 사용자 혼란 발생
- 항상 서버 상태 확인 후 링크 제공하도록 규칙화

### 커밋
- `04dacf5` - feat: Admin 포스트 저장/발행/배포 3단계 분리 (이 커밋에 포함)

---

## 오늘의 커밋 목록

| 순서 | 커밋 해시 | 메시지 |
|------|-----------|--------|
| 1 | `ab954c0` | Add digital-skill blog post: smartphone storage fix |
| 2 | `7416ba6` | chore: 환율 데이터 자동 업데이트 (2026-02-19) |
| 3 | `5d02d68` | Fix SSG prerender: add puppeteer dependency and adsense checklist |
| 4 | `e1645ab` | Add admin new post feature and UI improvements |
| 5 | `19a762c` | Update sitemap and RSS feed (201 URLs, 166 posts) |
| 6 | `52dc1ef` | chore: dist 폴더 gitignore 제외 및 프리렌더된 HTML 추가 |
| 7 | `64bd45f` | chore: Vercel 설정 - 빌드 건너뛰고 dist 폴더 직접 서빙 |
| 8 | `04dacf5` | feat: Admin 포스트 저장/발행/배포 3단계 분리 |
| 9 | `af7c1c9` | refactor: 카테고리 구조 간소화 |
| 10 | `e24fa8e` | feat: 이미지 업로드 기능 및 UI 개선 |

---

## 변경된 주요 파일 목록

### 소스 코드
| 파일 | 변경 내용 |
|------|-----------|
| `local-api.cjs` | build, deploy, upload-image 엔드포인트 추가 |
| `src/pages/admin/NewPostPage.tsx` | 3단계 버튼 분리, 이미지 업로드 기능 |
| `src/components/layout/Navbar.tsx` | 드롭다운 메뉴 삭제 |
| `src/components/home/CategoryTabs.tsx` | "유용한 도구" 링크 추가 |
| `src/data/categories.json` | 7개 → 5개 카테고리로 변경 |
| `src/data/posts.json` | 166개 포스트 categoryId 변경 |
| `CLAUDE.md` | 서버 실행 규칙 추가 |

### 설정 파일
| 파일 | 변경 내용 |
|------|-----------|
| `vercel.json` | 빌드 건너뛰기 설정 |
| `.gitignore` | dist 폴더 제외 해제 |
| `package.json` | puppeteer 의존성 |

### 문서
| 파일 | 내용 |
|------|------|
| `docs/adsense-checklist.md` | AdSense 승인 체크리스트 |
| `docs/2026-02-19_작업리스트.md` | 오늘 작업 기록 (이 문서) |

---

## 참고: 로컬 개발 서버 실행 방법

### 1. API 서버 실행
```bash
cd C:\NewProject\bujatime\goldenwave
node local-api.cjs
# → http://localhost:18790
```

### 2. 개발 서버 실행
```bash
npm run dev
# → http://localhost:5173 (또는 다른 포트)
```

### 3. Admin 페이지 접속
```
http://localhost:5173/admin
# 비밀번호 입력 후
http://localhost:5173/admin/new
```

---

## 다음 작업 예정

1. ~~이미지 업로드 기능 테스트~~ (완료)
2. AdSense 재신청 및 승인 대기
3. 브리핑 콘텐츠 추가 작성
4. "편집중" 카테고리 활용한 초안 관리 시스템 구축
