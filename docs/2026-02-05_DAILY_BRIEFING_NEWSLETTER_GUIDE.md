# ë§¤ì¼ ì•„ì¹¨ ë¶€ìë¸Œë¦¬í•‘ - ê¸°ëŠ¥ ì„¤ê³„ êµ¬í˜„ ê°€ì´ë“œ

> ì‘ì„±ì¼: 2026-02-05
> í”„ë¡œì íŠ¸: ë¶€ìíƒ€ì„ (bujatime.com)

---

## 1. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì „ì²´ ê°œìš”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ë¶€ìíƒ€ì„ í”„ë¡ íŠ¸ì—”ë“œ                         â”‚
â”‚  (React + Vite + Tailwind)                                      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ NewsletterCTAâ”‚   â”‚ êµ¬ë… í™•ì¸ í˜ì´ì§€â”‚   â”‚ êµ¬ë… í•´ì§€ í˜ì´ì§€  â”‚    â”‚
â”‚  â”‚ (ì´ë©”ì¼ ì…ë ¥) â”‚   â”‚ /subscribe/okâ”‚   â”‚ /unsubscribe     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ POST /subscribe
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Supabase (Backend)                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Edge Function     â”‚  â”‚ Edge Function     â”‚                    â”‚
â”‚  â”‚ subscribe-email   â”‚  â”‚ unsubscribe       â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚           â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚              PostgreSQL Database                    â”‚          â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚          â”‚
â”‚  â”‚  â”‚ subscribers      â”‚  â”‚ briefing_issues        â”‚  â”‚          â”‚
â”‚  â”‚  â”‚ - id             â”‚  â”‚ - id                   â”‚  â”‚          â”‚
â”‚  â”‚  â”‚ - email          â”‚  â”‚ - issue_date           â”‚  â”‚          â”‚
â”‚  â”‚  â”‚ - status         â”‚  â”‚ - subject              â”‚  â”‚          â”‚
â”‚  â”‚  â”‚ - token          â”‚  â”‚ - html_content         â”‚  â”‚          â”‚
â”‚  â”‚  â”‚ - subscribed_at  â”‚  â”‚ - sent_at              â”‚  â”‚          â”‚
â”‚  â”‚  â”‚ - unsubscribed_atâ”‚  â”‚ - recipient_count      â”‚  â”‚          â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ GitHub Actions (ë§¤ì¼ KST 07:00)
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ì½˜í…ì¸  íë ˆì´ì…˜ íŒŒì´í”„ë¼ì¸                        â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. ìˆ˜ì§‘  â”‚â”€â”€â–¶â”‚ 2. ìš”ì•½  â”‚â”€â”€â–¶â”‚ 3. ìƒì„±  â”‚â”€â”€â–¶â”‚ 4. ì´ë©”ì¼    â”‚  â”‚
â”‚  â”‚ (RSS/API)â”‚   â”‚ (Gemini) â”‚   â”‚ (HTML)   â”‚   â”‚    ë°œì†¡      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ (Resend API) â”‚  â”‚
â”‚                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ê¸°ìˆ  ìŠ¤íƒ ì„ ì •

| ì˜ì—­ | ì„ íƒ | ì´ìœ  |
|------|------|------|
| **DB & Auth** | Supabase (ë¬´ë£Œ í‹°ì–´) | PostgreSQL ê¸°ë°˜, Edge Functions ì œê³µ, ë¬´ë£Œ 500MB DB |
| **ì´ë©”ì¼ ë°œì†¡** | Resend | ì›” 3,000í†µ ë¬´ë£Œ, React Email ì§€ì›, API ê°„ë‹¨ |
| **AI ìš”ì•½** | Google Gemini API | ì´ë¯¸ GEMINI_API_KEY ì„¤ì •ë¨, ë¬´ë£Œ í‹°ì–´ ë„‰ë„‰ |
| **ë‰´ìŠ¤ ìˆ˜ì§‘** | RSS + ë„¤ì´ë²„ ë‰´ìŠ¤ API | ë¬´ë£Œ, í•œêµ­ ê¸ˆìœµ/ê²½ì œ ë‰´ìŠ¤ í’ë¶€ |
| **ìë™í™”** | GitHub Actions | ì´ë¯¸ í™˜ìœ¨ ì—…ë°ì´íŠ¸ì— ì‚¬ìš© ì¤‘, ì¶”ê°€ ë¹„ìš© ì—†ìŒ |
| **ì´ë©”ì¼ í…œí”Œë¦¿** | React Email + Tailwind | ê¸°ì¡´ ìŠ¤íƒê³¼ ì¼ê´€ì„±, ì•„ë¦„ë‹¤ìš´ ì´ë©”ì¼ ë””ìì¸ |

### ëŒ€ì•ˆ ë¹„êµ

**ì´ë©”ì¼ ë°œì†¡ ì„œë¹„ìŠ¤:**
| ì„œë¹„ìŠ¤ | ë¬´ë£Œ í•œë„ | ì¥ì  | ë‹¨ì  |
|--------|----------|------|------|
| **Resend** (ì¶”ì²œ) | 3,000í†µ/ì›” | API ì‹¬í”Œ, React Email í†µí•© | êµ¬ë…ì 1,000ëª… ë„˜ìœ¼ë©´ ìœ ë£Œ |
| SendGrid | 100í†µ/ì¼ | ê²€ì¦ëœ ì„œë¹„ìŠ¤ | API ë³µì¡, ì„¤ì • ë²ˆê±°ë¡œì›€ |
| Mailgun | 1,000í†µ/ì›” (3ê°œì›”) | ë†’ì€ ì „ë‹¬ë¥  | ë¬´ë£Œ ê¸°ê°„ ì§§ìŒ |
| AWS SES | $0.10/1,000í†µ | ê°€ì¥ ì €ë ´ | ì´ˆê¸° ì„¤ì • ë³µì¡ |

**ë°ì´í„° ì €ì¥:**
| ì„œë¹„ìŠ¤ | ë¬´ë£Œ í•œë„ | ì¥ì  | ë‹¨ì  |
|--------|----------|------|------|
| **Supabase** (ì¶”ì²œ) | 500MB DB, 50K MAU | Edge Functions í¬í•¨, ê´€ë¦¬ ì‰¬ì›€ | Row ì œí•œ (500K) |
| Firebase | Firestore 1GB | Google ìƒíƒœê³„ | ì¿¼ë¦¬ ì œí•œì  |
| PlanetScale | 1GB (deprecated) | MySQL í˜¸í™˜ | ë¬´ë£Œ í”Œëœ ì¢…ë£Œ ì˜ˆì • |

---

## 3. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (Supabase)

### 3.1 subscribers í…Œì´ë¸”

```sql
CREATE TABLE subscribers (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  status TEXT DEFAULT 'active' CHECK (status IN ('active', 'unsubscribed', 'bounced')),
  token UUID DEFAULT gen_random_uuid() NOT NULL, -- êµ¬ë… í•´ì§€ìš© ê³ ìœ  í† í°
  subscribed_at TIMESTAMPTZ DEFAULT NOW(),
  unsubscribed_at TIMESTAMPTZ,
  ip_address INET,
  source TEXT DEFAULT 'website', -- ìœ ì… ê²½ë¡œ (website, footer, popup ë“±)
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ì´ë©”ì¼ ê²€ìƒ‰ ì¸ë±ìŠ¤
CREATE INDEX idx_subscribers_email ON subscribers (email);
-- í™œì„± êµ¬ë…ì ì¡°íšŒìš©
CREATE INDEX idx_subscribers_active ON subscribers (status) WHERE status = 'active';

-- RLS (Row Level Security) ì •ì±…
ALTER TABLE subscribers ENABLE ROW LEVEL SECURITY;

-- ì„œë¹„ìŠ¤ í‚¤ë¡œë§Œ ì ‘ê·¼ ê°€ëŠ¥ (Edge Functionì—ì„œ ì‚¬ìš©)
CREATE POLICY "Service role only" ON subscribers
  FOR ALL USING (auth.role() = 'service_role');
```

### 3.2 briefing_issues í…Œì´ë¸”

```sql
CREATE TABLE briefing_issues (
  id SERIAL PRIMARY KEY,
  issue_date DATE UNIQUE NOT NULL,
  subject TEXT NOT NULL,             -- ì´ë©”ì¼ ì œëª©
  preview_text TEXT,                 -- ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° í…ìŠ¤íŠ¸
  html_content TEXT NOT NULL,        -- ìƒì„±ëœ HTML ë‰´ìŠ¤ë ˆí„°
  plain_text TEXT,                   -- í…ìŠ¤íŠ¸ ë²„ì „
  source_articles JSONB,            -- ìˆ˜ì§‘ëœ ì›ë³¸ ê¸°ì‚¬ ë©”íƒ€ë°ì´í„°
  ai_summary TEXT,                  -- AI ìš”ì•½ë³¸
  sent_at TIMESTAMPTZ,
  recipient_count INTEGER DEFAULT 0,
  open_count INTEGER DEFAULT 0,
  click_count INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_briefing_date ON briefing_issues (issue_date DESC);
```

### 3.3 briefing_clicks í…Œì´ë¸” (ì„ íƒì‚¬í•­ - í†µê³„ ì¶”ì )

```sql
CREATE TABLE briefing_clicks (
  id SERIAL PRIMARY KEY,
  issue_id INTEGER REFERENCES briefing_issues(id),
  subscriber_id UUID REFERENCES subscribers(id),
  link_url TEXT NOT NULL,
  clicked_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 4. Phase 1: ì´ë©”ì¼ êµ¬ë… ì‹œìŠ¤í…œ

### 4.1 Supabase Edge Function - êµ¬ë… ì²˜ë¦¬

**íŒŒì¼: `supabase/functions/subscribe-email/index.ts`**

```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
import { createClient } from "https://esm.sh/@supabase/supabase-js@2"

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://bujatime.com',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
}

serve(async (req) => {
  // CORS preflight
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders })
  }

  try {
    const { email } = await req.json()

    // ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/
    if (!email || !emailRegex.test(email)) {
      return new Response(
        JSON.stringify({ error: 'ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.' }),
        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
      )
    }

    const supabase = createClient(
      Deno.env.get('SUPABASE_URL')!,
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
    )

    // ì´ë¯¸ êµ¬ë… ì¤‘ì¸ì§€ í™•ì¸
    const { data: existing } = await supabase
      .from('subscribers')
      .select('id, status')
      .eq('email', email.toLowerCase().trim())
      .single()

    if (existing) {
      if (existing.status === 'active') {
        return new Response(
          JSON.stringify({ message: 'ì´ë¯¸ êµ¬ë… ì¤‘ì…ë‹ˆë‹¤!' }),
          { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
        )
      }
      // êµ¬ë… í•´ì§€í–ˆë˜ ì‚¬ìš©ì ì¬êµ¬ë…
      await supabase
        .from('subscribers')
        .update({ status: 'active', unsubscribed_at: null })
        .eq('id', existing.id)
    } else {
      // ì‹ ê·œ êµ¬ë…
      const ip = req.headers.get('x-forwarded-for') || req.headers.get('cf-connecting-ip')
      await supabase
        .from('subscribers')
        .insert({
          email: email.toLowerCase().trim(),
          ip_address: ip,
          source: 'website'
        })
    }

    return new Response(
      JSON.stringify({ message: 'êµ¬ë…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë§¤ì¼ ì•„ì¹¨ ë¶€ìë¸Œë¦¬í•‘ì„ ë³´ë‚´ë“œë¦´ê²Œìš”.' }),
      { status: 200, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    )
  } catch (error) {
    return new Response(
      JSON.stringify({ error: 'êµ¬ë… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' }),
      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    )
  }
})
```

### 4.2 í”„ë¡ íŠ¸ì—”ë“œ NewsletterCTA ìˆ˜ì •

**íŒŒì¼: `src/components/home/NewsletterCTA.tsx`**

```tsx
import { useState } from 'react'
import { Mail, ArrowRight, Check, Loader2 } from 'lucide-react'

const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL
const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY

export default function NewsletterCTA() {
  const [email, setEmail] = useState('')
  const [status, setStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle')
  const [message, setMessage] = useState('')

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault()
    setStatus('loading')

    try {
      const res = await fetch(`${SUPABASE_URL}/functions/v1/subscribe-email`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
        },
        body: JSON.stringify({ email }),
      })

      const data = await res.json()

      if (res.ok) {
        setStatus('success')
        setMessage(data.message)
        setEmail('')
      } else {
        setStatus('error')
        setMessage(data.error || 'êµ¬ë… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.')
      }
    } catch {
      setStatus('error')
      setMessage('ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.')
    }

    // 5ì´ˆ í›„ ìƒíƒœ ì´ˆê¸°í™”
    setTimeout(() => {
      setStatus('idle')
      setMessage('')
    }, 5000)
  }

  return (
    <section data-newsletter className="py-16 bg-gradient-to-br from-soot-900 via-soot-800 to-moss-900">
      <div className="container mx-auto px-6 text-center">
        {/* ... ê¸°ì¡´ ì•„ì´ì½˜/íƒ€ì´í‹€ ìœ ì§€ ... */}

        {status === 'success' ? (
          <div className="flex items-center justify-center gap-2 text-moss-400 text-lg">
            <Check size={20} />
            <span>{message}</span>
          </div>
        ) : (
          <form onSubmit={handleSubmit} className="flex flex-col sm:flex-row items-center gap-3 max-w-md mx-auto">
            <input
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥"
              required
              disabled={status === 'loading'}
              className="w-full px-5 py-3.5 bg-white/10 border border-white/20 rounded-full text-white placeholder-soot-400 focus:outline-none focus:ring-2 focus:ring-moss-500 focus:border-transparent text-sm disabled:opacity-50"
            />
            <button
              type="submit"
              disabled={status === 'loading'}
              className="w-full sm:w-auto flex-shrink-0 px-6 py-3.5 bg-moss-600 hover:bg-moss-500 text-white rounded-full font-semibold text-sm transition-colors flex items-center justify-center gap-2 shadow-lg shadow-moss-900/30 disabled:opacity-50"
            >
              {status === 'loading' ? (
                <><Loader2 size={16} className="animate-spin" /> ì²˜ë¦¬ ì¤‘...</>
              ) : (
                <>êµ¬ë…í•˜ê¸° <ArrowRight size={16} /></>
              )}
            </button>
          </form>
        )}

        {status === 'error' && (
          <p className="mt-3 text-red-400 text-sm">{message}</p>
        )}

        <p className="mt-4 text-xs text-soot-500">
          êµ¬ë…ì€ ì–¸ì œë“  ì·¨ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤íŒ¸ ì—†ì´, ê°€ì¹˜ ìˆëŠ” ì½˜í…ì¸ ë§Œ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.
        </p>
      </div>
    </section>
  )
}
```

### 4.3 í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

**`.env` (ë¡œì»¬ ê°œë°œ)**
```
VITE_SUPABASE_URL=https://xxxxx.supabase.co
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJI...
```

**GitHub Secrets (ë°°í¬)**
```
SUPABASE_URL
SUPABASE_SERVICE_ROLE_KEY
RESEND_API_KEY
GEMINI_API_KEY
```

---

## 5. Phase 2: ì½˜í…ì¸  íë ˆì´ì…˜ íŒŒì´í”„ë¼ì¸

### 5.1 ë‰´ìŠ¤ ìˆ˜ì§‘ ì†ŒìŠ¤

| ì†ŒìŠ¤ | ìœ í˜• | ìˆ˜ì§‘ í•­ëª© | ë°©ë²• |
|------|------|----------|------|
| ë„¤ì´ë²„ ë‰´ìŠ¤ RSS | RSS | ê²½ì œ/ê¸ˆìœµ/ë¶€ë™ì‚°/ì£¼ì‹ ë‰´ìŠ¤ | RSS íŒŒì‹± |
| í•œêµ­ì€í–‰ | API | ê¸°ì¤€ê¸ˆë¦¬, ê²½ì œ ì§€í‘œ | ê³µê³µ API |
| KOSPI/KOSDAQ | í¬ë¡¤ë§ | ì „ì¼ ì¢…ê°€, ë“±ë½ë¥  | Yahoo Finance API |
| í™˜ìœ¨ | ê¸°ì¡´ ë°ì´í„° | USD/JPY/EUR í™˜ìœ¨ | ì´ë¯¸ êµ¬ì¶•ë¨ (exchange-rates.json) |
| ë¶€ìíƒ€ì„ ë¸”ë¡œê·¸ | ë‚´ë¶€ ë°ì´í„° | ìµœì‹  í¬ìŠ¤íŠ¸ | posts.json ì°¸ì¡° |
| ì½”ì¸ ì‹œì„¸ | API | BTC/ETH ê°€ê²© | CoinGecko API (ë¬´ë£Œ) |

### 5.2 ìˆ˜ì§‘ ìŠ¤í¬ë¦½íŠ¸

**íŒŒì¼: `scripts/collect-news.mjs`**

```javascript
import { writeFileSync } from 'fs';

// â”€â”€â”€ 1. ë„¤ì´ë²„ ë‰´ìŠ¤ RSS ìˆ˜ì§‘ â”€â”€â”€
async function fetchNaverNews() {
  const categories = [
    { name: 'ê²½ì œ', url: 'https://news.google.com/rss/topics/CAAqIQgKIhtDQkFTRGdvSUwyMHZNRGx6TVdZU0FtdHZLQUFQAQ?hl=ko&gl=KR&ceid=KR:ko' },
    // ë˜ëŠ” ë„¤ì´ë²„ ë‰´ìŠ¤ RSS
  ];

  const articles = [];
  for (const cat of categories) {
    try {
      const res = await fetch(cat.url);
      const xml = await res.text();
      // XML íŒŒì‹±í•˜ì—¬ ì œëª©, ë§í¬, ì„¤ëª… ì¶”ì¶œ
      const items = parseRSS(xml);
      articles.push(...items.slice(0, 5).map(item => ({
        ...item,
        category: cat.name
      })));
    } catch (e) {
      console.error(`${cat.name} ìˆ˜ì§‘ ì‹¤íŒ¨:`, e.message);
    }
  }
  return articles;
}

// â”€â”€â”€ 2. ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘ â”€â”€â”€
async function fetchMarketData() {
  // KOSPI / KOSDAQ
  const yahooRes = await fetch('https://query1.finance.yahoo.com/v8/finance/chart/%5EKS11');
  const kospiData = await yahooRes.json();

  // í™˜ìœ¨ (ê¸°ì¡´ ë°ì´í„° í™œìš©)
  const exchangeRes = await fetch('https://open.er-api.com/v6/latest/KRW');
  const exchangeData = await exchangeRes.json();

  // ì½”ì¸
  const coinRes = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum&vs_currencies=krw&include_24hr_change=true');
  const coinData = await coinRes.json();

  return {
    kospi: kospiData,
    exchange: exchangeData,
    crypto: coinData
  };
}

// â”€â”€â”€ 3. ë¶€ìíƒ€ì„ ìµœì‹  í¬ìŠ¤íŠ¸ â”€â”€â”€
function getLatestPosts() {
  const posts = JSON.parse(readFileSync('src/data/posts.json', 'utf-8'));
  return posts
    .sort((a, b) => new Date(b.date) - new Date(a.date))
    .slice(0, 3);
}

// â”€â”€â”€ ë©”ì¸ ì‹¤í–‰ â”€â”€â”€
async function main() {
  console.log('ğŸ“° ë‰´ìŠ¤ ìˆ˜ì§‘ ì‹œì‘...');

  const [news, market, posts] = await Promise.all([
    fetchNaverNews(),
    fetchMarketData(),
    Promise.resolve(getLatestPosts())
  ]);

  const collectedData = {
    date: new Date().toISOString().split('T')[0],
    collectedAt: new Date().toISOString(),
    news,
    market,
    latestPosts: posts
  };

  writeFileSync(
    'scripts/temp/collected-data.json',
    JSON.stringify(collectedData, null, 2)
  );

  console.log(`âœ… ìˆ˜ì§‘ ì™„ë£Œ: ë‰´ìŠ¤ ${news.length}ê±´, ì‹œì¥ ë°ì´í„°, ìµœì‹  í¬ìŠ¤íŠ¸ ${posts.length}ê±´`);
}

main().catch(console.error);
```

### 5.3 AI ìš”ì•½ ìŠ¤í¬ë¦½íŠ¸

**íŒŒì¼: `scripts/generate-briefing.mjs`**

```javascript
import { readFileSync, writeFileSync } from 'fs';

const GEMINI_API_KEY = process.env.GEMINI_API_KEY;
const GEMINI_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${GEMINI_API_KEY}`;

async function generateBriefing() {
  const collected = JSON.parse(readFileSync('scripts/temp/collected-data.json', 'utf-8'));

  const prompt = `
ë‹¹ì‹ ì€ "ë¶€ìíƒ€ì„"ì´ë¼ëŠ” í•œêµ­ ê¸ˆìœµ ì¸ì‚¬ì´íŠ¸ ë¯¸ë””ì–´ì˜ ì—ë””í„°ì…ë‹ˆë‹¤.
ì•„ë˜ ìˆ˜ì§‘ëœ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ "ë§¤ì¼ ì•„ì¹¨ ë¶€ìë¸Œë¦¬í•‘" ë‰´ìŠ¤ë ˆí„°ë¥¼ ì‘ì„±í•˜ì„¸ìš”.

## ì‘ì„± ê·œì¹™
1. í†¤: ì¹œê·¼í•˜ì§€ë§Œ ì „ë¬¸ì , 20-40ëŒ€ ì§ì¥ì¸ ëŒ€ìƒ
2. êµ¬ì¡°:
   - ğŸ“Š ì˜¤ëŠ˜ì˜ ì‹œì¥ í•œëˆˆì— (KOSPI, í™˜ìœ¨, ì½”ì¸ ë“± í•µì‹¬ ìˆ˜ì¹˜)
   - ğŸ”¥ ì£¼ìš” ë‰´ìŠ¤ TOP 5 (ê° 2-3ì¤„ ìš”ì•½ + ì›ë¬¸ ë§í¬)
   - ğŸ’¡ ì˜¤ëŠ˜ì˜ ë¶€ì ì¸ì‚¬ì´íŠ¸ (ì‹¤ì²œ ê°€ëŠ¥í•œ ê¸ˆìœµ íŒ 1ê°€ì§€)
   - ğŸ“– ë¶€ìíƒ€ì„ ì¶”ì²œ ê¸€ (ìµœì‹  ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ì†Œê°œ)
3. ì „ì²´ ë¶„ëŸ‰: 800-1,200ì (ì½ëŠ” ë° 3ë¶„ ì´ë‚´)
4. ì´ëª¨ì§€ ì ì ˆíˆ ì‚¬ìš©í•˜ë˜ ê³¼í•˜ì§€ ì•Šê²Œ
5. ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥

## ìˆ˜ì§‘ ë°ì´í„°
${JSON.stringify(collected, null, 2)}
`;

  const response = await fetch(GEMINI_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      contents: [{ parts: [{ text: prompt }] }],
      generationConfig: {
        temperature: 0.7,
        maxOutputTokens: 2048,
      }
    })
  });

  const result = await response.json();
  const briefingText = result.candidates[0].content.parts[0].text;

  // ì´ë©”ì¼ ì œëª© ìƒì„±
  const titlePrompt = `
ë‹¤ìŒ ë‰´ìŠ¤ë ˆí„° ë‚´ìš©ì„ ë³´ê³ , í´ë¦­í•˜ê³  ì‹¶ì€ ì´ë©”ì¼ ì œëª©ì„ 1ê°œë§Œ ì‘ì„±í•˜ì„¸ìš”.
ê·œì¹™: 30ì ì´ë‚´, í•µì‹¬ ìˆ«ìë‚˜ í‚¤ì›Œë“œ í¬í•¨, ì´ëª¨ì§€ 1ê°œ ì‚¬ìš©
ë‚´ìš©: ${briefingText.substring(0, 500)}
`;

  const titleRes = await fetch(GEMINI_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      contents: [{ parts: [{ text: titlePrompt }] }],
      generationConfig: { temperature: 0.9, maxOutputTokens: 100 }
    })
  });

  const titleResult = await titleRes.json();
  const subject = titleResult.candidates[0].content.parts[0].text.trim();

  const briefingData = {
    date: collected.date,
    subject,
    markdown: briefingText,
    generatedAt: new Date().toISOString()
  };

  writeFileSync(
    'scripts/temp/briefing-content.json',
    JSON.stringify(briefingData, null, 2)
  );

  console.log(`âœ… ë¸Œë¦¬í•‘ ìƒì„± ì™„ë£Œ: "${subject}"`);
}

generateBriefing().catch(console.error);
```

---

## 6. Phase 3: ì´ë©”ì¼ í…œí”Œë¦¿ ìƒì„±

### 6.1 HTML ì´ë©”ì¼ í…œí”Œë¦¿

**íŒŒì¼: `scripts/generate-email-html.mjs`**

ì´ë©”ì¼ í´ë¼ì´ì–¸íŠ¸ í˜¸í™˜ì„±ì„ ìœ„í•´ ì¸ë¼ì¸ CSS + í…Œì´ë¸” ë ˆì´ì•„ì›ƒ ì‚¬ìš©.

```javascript
import { readFileSync, writeFileSync } from 'fs';

function markdownToEmailHtml(markdown) {
  // ë§ˆí¬ë‹¤ìš´ì„ ì´ë©”ì¼ í˜¸í™˜ HTMLë¡œ ë³€í™˜
  let html = markdown
    .replace(/^### (.*$)/gim, '<h3 style="color:#1a1a1a;font-size:18px;margin:20px 0 8px;">$1</h3>')
    .replace(/^## (.*$)/gim, '<h2 style="color:#1a1a1a;font-size:22px;margin:24px 0 12px;">$1</h2>')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" style="color:#2d6a4f;text-decoration:underline;">$1</a>')
    .replace(/\n\n/g, '</p><p style="color:#333;font-size:16px;line-height:1.7;margin:0 0 16px;">')
    .replace(/\n/g, '<br>');

  return `<p style="color:#333;font-size:16px;line-height:1.7;margin:0 0 16px;">${html}</p>`;
}

function generateEmailTemplate(briefingData, unsubscribeUrl) {
  const { date, subject, markdown } = briefingData;
  const contentHtml = markdownToEmailHtml(markdown);

  const formattedDate = new Date(date).toLocaleDateString('ko-KR', {
    year: 'numeric', month: 'long', day: 'numeric', weekday: 'long'
  });

  return `
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${subject}</title>
</head>
<body style="margin:0;padding:0;background-color:#f5f0eb;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">

  <!-- í”„ë¦¬í—¤ë” í…ìŠ¤íŠ¸ (ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸°) -->
  <div style="display:none;max-height:0;overflow:hidden;">
    ${subject} - ë¶€ìíƒ€ì„ì´ ì „í•˜ëŠ” ì˜¤ëŠ˜ì˜ ê¸ˆìœµ ë¸Œë¦¬í•‘
  </div>

  <table width="100%" cellpadding="0" cellspacing="0" style="background-color:#f5f0eb;padding:24px 0;">
    <tr>
      <td align="center">
        <table width="600" cellpadding="0" cellspacing="0" style="max-width:600px;width:100%;">

          <!-- í—¤ë” -->
          <tr>
            <td style="background:linear-gradient(135deg,#1a1a1a,#2d2d2d);padding:32px 40px;border-radius:16px 16px 0 0;">
              <table width="100%">
                <tr>
                  <td>
                    <h1 style="color:#d4a574;font-size:24px;margin:0;font-weight:800;">
                      â˜€ï¸ ë¶€ìë¸Œë¦¬í•‘
                    </h1>
                    <p style="color:#888;font-size:13px;margin:8px 0 0;">
                      ${formattedDate}
                    </p>
                  </td>
                  <td align="right" valign="top">
                    <a href="https://bujatime.com" style="color:#d4a574;font-size:14px;text-decoration:none;font-weight:600;">
                      bujatime.com
                    </a>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- ë³¸ë¬¸ -->
          <tr>
            <td style="background-color:#ffffff;padding:40px;">
              ${contentHtml}
            </td>
          </tr>

          <!-- CTA: ë¶€ìíƒ€ì„ ë°©ë¬¸ -->
          <tr>
            <td style="background-color:#ffffff;padding:0 40px 40px;text-align:center;">
              <a href="https://bujatime.com"
                 style="display:inline-block;background-color:#2d6a4f;color:#ffffff;padding:14px 32px;border-radius:50px;text-decoration:none;font-weight:600;font-size:15px;">
                ë¶€ìíƒ€ì„ì—ì„œ ë” ì½ê¸° â†’
              </a>
            </td>
          </tr>

          <!-- í‘¸í„° -->
          <tr>
            <td style="background-color:#f0ebe4;padding:24px 40px;border-radius:0 0 16px 16px;text-align:center;">
              <p style="color:#888;font-size:12px;margin:0 0 8px;">
                ì´ ì´ë©”ì¼ì€ ë¶€ìíƒ€ì„ ë‰´ìŠ¤ë ˆí„°ë¥¼ êµ¬ë…í•˜ì…¨ê¸° ë•Œë¬¸ì— ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.
              </p>
              <a href="${unsubscribeUrl}"
                 style="color:#888;font-size:12px;text-decoration:underline;">
                êµ¬ë… í•´ì§€í•˜ê¸°
              </a>
              <p style="color:#aaa;font-size:11px;margin:16px 0 0;">
                Â© 2026 ë¶€ìíƒ€ì„ | hello@bujatime.com
              </p>
            </td>
          </tr>

        </table>
      </td>
    </tr>
  </table>
</body>
</html>`;
}

// ì‹¤í–‰
const briefing = JSON.parse(readFileSync('scripts/temp/briefing-content.json', 'utf-8'));
const html = generateEmailTemplate(briefing, '{{UNSUBSCRIBE_URL}}');
writeFileSync('scripts/temp/briefing-email.html', html);
console.log('âœ… ì´ë©”ì¼ HTML ìƒì„± ì™„ë£Œ');
```

---

## 7. Phase 4: ì´ë©”ì¼ ë°œì†¡ ì‹œìŠ¤í…œ

### 7.1 Resendë¥¼ í†µí•œ ë°œì†¡

**íŒŒì¼: `scripts/send-briefing.mjs`**

```javascript
import { readFileSync } from 'fs';

const RESEND_API_KEY = process.env.RESEND_API_KEY;
const SUPABASE_URL = process.env.SUPABASE_URL;
const SUPABASE_SERVICE_KEY = process.env.SUPABASE_SERVICE_ROLE_KEY;

async function getActiveSubscribers() {
  const res = await fetch(`${SUPABASE_URL}/rest/v1/subscribers?status=eq.active&select=id,email,token`, {
    headers: {
      'apikey': SUPABASE_SERVICE_KEY,
      'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
    }
  });
  return res.json();
}

async function sendEmail(to, subject, html, unsubscribeToken) {
  // ê°œë³„ êµ¬ë… í•´ì§€ URL ì‚½ì…
  const personalizedHtml = html.replace(
    '{{UNSUBSCRIBE_URL}}',
    `https://bujatime.com/unsubscribe?token=${unsubscribeToken}`
  );

  const res = await fetch('https://api.resend.com/emails', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${RESEND_API_KEY}`,
    },
    body: JSON.stringify({
      from: 'ë¶€ìíƒ€ì„ <briefing@bujatime.com>',
      to: [to],
      subject: subject,
      html: personalizedHtml,
      headers: {
        'List-Unsubscribe': `<https://bujatime.com/unsubscribe?token=${unsubscribeToken}>`,
        'List-Unsubscribe-Post': 'List-Unsubscribe=One-Click',
      }
    })
  });

  return res.json();
}

async function saveBriefingIssue(briefing, html, recipientCount) {
  await fetch(`${SUPABASE_URL}/rest/v1/briefing_issues`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'apikey': SUPABASE_SERVICE_KEY,
      'Authorization': `Bearer ${SUPABASE_SERVICE_KEY}`,
    },
    body: JSON.stringify({
      issue_date: briefing.date,
      subject: briefing.subject,
      html_content: html,
      ai_summary: briefing.markdown,
      sent_at: new Date().toISOString(),
      recipient_count: recipientCount,
    })
  });
}

async function main() {
  const briefing = JSON.parse(readFileSync('scripts/temp/briefing-content.json', 'utf-8'));
  const html = readFileSync('scripts/temp/briefing-email.html', 'utf-8');
  const subscribers = await getActiveSubscribers();

  console.log(`ğŸ“¬ ë°œì†¡ ì‹œì‘: ${subscribers.length}ëª… ëŒ€ìƒ`);

  let successCount = 0;
  let failCount = 0;

  // ë°°ì¹˜ ë°œì†¡ (Resend ë¬´ë£Œ í‹°ì–´: ì´ˆë‹¹ 2í†µ ì œí•œ)
  for (let i = 0; i < subscribers.length; i++) {
    const sub = subscribers[i];
    try {
      await sendEmail(sub.email, briefing.subject, html, sub.token);
      successCount++;
      console.log(`  âœ… [${i + 1}/${subscribers.length}] ${sub.email}`);
    } catch (err) {
      failCount++;
      console.error(`  âŒ [${i + 1}/${subscribers.length}] ${sub.email}: ${err.message}`);
    }

    // Rate limit: 500ms ê°„ê²©
    if (i < subscribers.length - 1) {
      await new Promise(r => setTimeout(r, 500));
    }
  }

  // ë°œì†¡ ê¸°ë¡ ì €ì¥
  await saveBriefingIssue(briefing, html, successCount);

  console.log(`\nğŸ“Š ë°œì†¡ ì™„ë£Œ: ì„±ê³µ ${successCount}ê±´, ì‹¤íŒ¨ ${failCount}ê±´`);
}

main().catch(console.error);
```

### 7.2 êµ¬ë…ì ê·œëª¨ë³„ ë°œì†¡ ì „ëµ

| êµ¬ë…ì ìˆ˜ | ì „ëµ | ì„œë¹„ìŠ¤ | ì˜ˆìƒ ë¹„ìš© |
|-----------|------|--------|----------|
| ~1,000ëª… | Resend ì§ì ‘ ë°œì†¡ | Resend ë¬´ë£Œ | ë¬´ë£Œ |
| 1,000~5,000ëª… | Resend Pro | Resend | $20/ì›” |
| 5,000~10,000ëª… | AWS SES + í | AWS SES | ~$1/ì¼ |
| 10,000ëª…+ | ì „ë¬¸ ESP | Mailchimp/Stibee | ë³„ë„ ê²¬ì  |

---

## 8. Phase 5: êµ¬ë… í•´ì§€ ì‹œìŠ¤í…œ

### 8.1 Supabase Edge Function - êµ¬ë… í•´ì§€

**íŒŒì¼: `supabase/functions/unsubscribe/index.ts`**

```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts"
import { createClient } from "https://esm.sh/@supabase/supabase-js@2"

serve(async (req) => {
  const url = new URL(req.url);
  const token = url.searchParams.get('token');

  if (!token) {
    return new Response('ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤.', { status: 400 });
  }

  const supabase = createClient(
    Deno.env.get('SUPABASE_URL')!,
    Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')!
  );

  const { data, error } = await supabase
    .from('subscribers')
    .update({
      status: 'unsubscribed',
      unsubscribed_at: new Date().toISOString()
    })
    .eq('token', token)
    .eq('status', 'active');

  // êµ¬ë… í•´ì§€ í™•ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  return new Response(null, {
    status: 302,
    headers: { 'Location': 'https://bujatime.com/unsubscribe/complete' }
  });
});
```

### 8.2 í”„ë¡ íŠ¸ì—”ë“œ êµ¬ë… í•´ì§€ í˜ì´ì§€

**íŒŒì¼: `src/pages/UnsubscribePage.tsx`**

êµ¬ë… í•´ì§€ ì™„ë£Œ í™•ì¸ í˜ì´ì§€. ê°„ê²°í•˜ê²Œ "êµ¬ë…ì´ í•´ì§€ë˜ì—ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€ì™€ ì¬êµ¬ë… ë§í¬ ì œê³µ.

---

## 9. GitHub Actions ìë™í™”

### 9.1 ë§¤ì¼ ì•„ì¹¨ ë¸Œë¦¬í•‘ ë°œì†¡ ì›Œí¬í”Œë¡œìš°

**íŒŒì¼: `.github/workflows/daily-briefing.yml`**

```yaml
name: Daily Briefing Newsletter

on:
  schedule:
    # ë§¤ì¼ í•œêµ­ì‹œê°„ ì˜¤ì „ 7ì‹œ (UTC 22ì‹œ, ì „ë‚ ) ì‹¤í–‰
    - cron: '0 22 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

env:
  GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
  SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
  SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
  RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}

jobs:
  send-briefing:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Create temp directory
        run: mkdir -p scripts/temp

      # Step 1: ë‰´ìŠ¤/ì‹œì¥ ë°ì´í„° ìˆ˜ì§‘
      - name: Collect news and market data
        run: node scripts/collect-news.mjs

      # Step 2: AI ë¸Œë¦¬í•‘ ìƒì„±
      - name: Generate briefing with Gemini
        run: node scripts/generate-briefing.mjs

      # Step 3: ì´ë©”ì¼ HTML ìƒì„±
      - name: Generate email template
        run: node scripts/generate-email-html.mjs

      # Step 4: ì´ë©”ì¼ ë°œì†¡
      - name: Send briefing emails
        run: node scripts/send-briefing.mjs

      # ì •ë¦¬
      - name: Cleanup temp files
        if: always()
        run: rm -rf scripts/temp
```

---

## 10. ì „ì²´ êµ¬í˜„ ìˆœì„œ (ë‹¨ê³„ë³„)

### Stage 1: ê¸°ë°˜ ì¸í”„ë¼ (ìµœìš°ì„ )

```
[1] Supabase í”„ë¡œì íŠ¸ ìƒì„±
[2] subscribers í…Œì´ë¸” + RLS ì •ì±… ìƒì„±
[3] briefing_issues í…Œì´ë¸” ìƒì„±
[4] subscribe-email Edge Function ë°°í¬
[5] .envì— VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY ì¶”ê°€
[6] NewsletterCTA.tsx â†’ Supabase ì—°ë™ (Phase 4.2 ì½”ë“œ)
[7] í…ŒìŠ¤íŠ¸: ì´ë©”ì¼ êµ¬ë… â†’ DB ì €ì¥ í™•ì¸
```

### Stage 2: ì½˜í…ì¸  íŒŒì´í”„ë¼ì¸

```
[8] scripts/collect-news.mjs ì‘ì„± (ë‰´ìŠ¤ ìˆ˜ì§‘)
[9] scripts/generate-briefing.mjs ì‘ì„± (AI ìš”ì•½)
[10] scripts/generate-email-html.mjs ì‘ì„± (ì´ë©”ì¼ í…œí”Œë¦¿)
[11] ë¡œì»¬ì—ì„œ ìˆ˜ë™ í…ŒìŠ¤íŠ¸ (ìˆ˜ì§‘ â†’ ìš”ì•½ â†’ HTML ìƒì„±)
```

### Stage 3: ë°œì†¡ ì‹œìŠ¤í…œ

```
[12] Resend ê³„ì • ìƒì„± + bujatime.com ë„ë©”ì¸ ì¸ì¦
[13] scripts/send-briefing.mjs ì‘ì„±
[14] í…ŒìŠ¤íŠ¸ ì´ë©”ì¼ ë°œì†¡ (ìì‹ ì—ê²Œ)
[15] unsubscribe Edge Function ë°°í¬
[16] UnsubscribePage.tsx í”„ë¡ íŠ¸ì—”ë“œ ì¶”ê°€
```

### Stage 4: ìë™í™”

```
[17] .github/workflows/daily-briefing.yml ì‘ì„±
[18] GitHub Secrets ì„¤ì •
[19] workflow_dispatchë¡œ ìˆ˜ë™ í…ŒìŠ¤íŠ¸
[20] cron ìŠ¤ì¼€ì¤„ í™œì„±í™” â†’ ìë™ ë°œì†¡ ì‹œì‘
```

### Stage 5: ê°œì„  (ì„ íƒ)

```
[21] ì›¹ì—ì„œ ì§€ë‚œ ë¸Œë¦¬í•‘ ì•„ì¹´ì´ë¸Œ í˜ì´ì§€ (/briefing/archive)
[22] ì—´ëŒìœ¨/í´ë¦­ìœ¨ ì¶”ì 
[23] êµ¬ë…ì ì„¸ê·¸ë¨¼íŠ¸ (ê´€ì‹¬ì‚¬ë³„)
[24] Welcome ì´ë©”ì¼ (êµ¬ë… ì‹œ ìë™ ë°œì†¡)
[25] A/B í…ŒìŠ¤íŠ¸ (ì œëª©ì¤„)
```

---

## 11. ë¹„ìš© ì˜ˆìƒ

### ë¬´ë£Œ ë‹¨ê³„ (êµ¬ë…ì 1,000ëª… ì´í•˜)

| í•­ëª© | ë¹„ìš© |
|------|------|
| Supabase ë¬´ë£Œ í”Œëœ | $0 |
| Resend ë¬´ë£Œ í”Œëœ (3,000í†µ/ì›”) | $0 |
| Gemini API ë¬´ë£Œ í‹°ì–´ | $0 |
| GitHub Actions (2,000ë¶„/ì›”) | $0 |
| **í•©ê³„** | **$0/ì›”** |

### ì„±ì¥ ë‹¨ê³„ (êµ¬ë…ì 5,000ëª…)

| í•­ëª© | ë¹„ìš© |
|------|------|
| Supabase Pro | $25/ì›” |
| Resend Pro | $20/ì›” |
| Gemini API | ~$1/ì›” |
| **í•©ê³„** | **~$46/ì›”** |

---

## 12. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **ì´ë©”ì¼ ì£¼ì†Œ ë³´í˜¸**: RLS í™œì„±í™”, service_role í‚¤ë§Œ DB ì ‘ê·¼
2. **êµ¬ë… í•´ì§€ í† í°**: UUID ê¸°ë°˜ ì¶”ì¸¡ ë¶ˆê°€ëŠ¥í•œ í† í°
3. **Rate Limiting**: Edge Functionì— rate limit ì ìš©
4. **CORS**: bujatime.com ë„ë©”ì¸ë§Œ í—ˆìš©
5. **ì´ë©”ì¼ ì¸ì¦**: Resend ë„ë©”ì¸ ì¸ì¦ (SPF, DKIM, DMARC)
6. **í™˜ê²½ ë³€ìˆ˜**: ë¯¼ê° ì •ë³´ëŠ” ë°˜ë“œì‹œ GitHub Secrets ì‚¬ìš©
7. **List-Unsubscribe í—¤ë”**: ìŠ¤íŒ¸ í•„í„° íšŒí”¼, ë²•ì  ìš”êµ¬ì‚¬í•­ ì¤€ìˆ˜

---

## 13. ëª¨ë‹ˆí„°ë§ & ëŒ€ì‹œë³´ë“œ (ì„ íƒ)

ê°„ë‹¨í•œ ê´€ë¦¬ì í†µê³„ í˜ì´ì§€ ì¶”ê°€ ê°€ëŠ¥:

```
/admin/briefing (ë¹„ê³µê°œ)
â”œâ”€â”€ ì´ êµ¬ë…ì ìˆ˜ / í™œì„± êµ¬ë…ì ìˆ˜
â”œâ”€â”€ ìµœê·¼ 30ì¼ êµ¬ë…/í•´ì§€ ì¶”ì´
â”œâ”€â”€ ë°œì†¡ íˆìŠ¤í† ë¦¬ (ë‚ ì§œ, ì œëª©, ë°œì†¡ ìˆ˜, ì—´ëŒë¥ )
â””â”€â”€ ìµœê·¼ ë¸Œë¦¬í•‘ ë¯¸ë¦¬ë³´ê¸°
```

---

## ìš”ì•½

| êµ¬ë¶„ | ë‚´ìš© |
|------|------|
| **í•µì‹¬ ìŠ¤íƒ** | Supabase + Resend + Gemini + GitHub Actions |
| **ì´ˆê¸° ë¹„ìš©** | $0 (ë¬´ë£Œ í‹°ì–´ í™œìš©) |
| **ìë™í™” ìˆ˜ì¤€** | ì™„ì „ ìë™ (ë§¤ì¼ KST 07:00 ë°œì†¡) |
| **êµ¬í˜„ íŒŒì¼** | ìŠ¤í¬ë¦½íŠ¸ 4ê°œ + Edge Function 2ê°œ + í”„ë¡ íŠ¸ì—”ë“œ 2ê°œ + ì›Œí¬í”Œë¡œìš° 1ê°œ |
| **í™•ì¥ì„±** | êµ¬ë…ì ê·œëª¨ì— ë”°ë¼ ë‹¨ê³„ì  í™•ì¥ ê°€ëŠ¥ |
