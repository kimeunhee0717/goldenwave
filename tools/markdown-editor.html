<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë§ˆí¬ë‹¤ìš´ ì—ë””í„° - ë¶€ìíƒ€ì„</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', -apple-system, sans-serif; background: #f8f6f3; color: #3d2e22; }
  
  .header { background: linear-gradient(135deg, #d4a853, #c4943f); color: white; padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; }
  .header h1 { font-size: 20px; font-weight: 700; }
  .header .badge { background: rgba(255,255,255,0.2); padding: 4px 12px; border-radius: 20px; font-size: 12px; }
  
  .toolbar { background: white; border-bottom: 1px solid #e8e0d5; padding: 12px 24px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
  .btn { padding: 8px 16px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s; }
  .btn:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
  .btn-fix { background: #7c3aed; color: white; }
  .btn-fix:hover { background: #6d28d9; }
  .btn-preview { background: #f59e0b; color: white; }
  .btn-preview:hover { background: #d97706; }
  .btn-copy { background: #10b981; color: white; }
  .btn-copy:hover { background: #059669; }
  .btn-clear { background: #ef4444; color: white; }
  .btn-clear:hover { background: #dc2626; }
  .btn-paste { background: #3b82f6; color: white; }
  .btn-paste:hover { background: #2563eb; }
  
  .main { display: flex; height: calc(100vh - 120px); }
  .panel { flex: 1; display: flex; flex-direction: column; }
  .panel-header { padding: 10px 16px; background: #f3ede4; border-bottom: 1px solid #e8e0d5; font-size: 13px; font-weight: 600; color: #8b7355; display: flex; justify-content: space-between; align-items: center; }
  .panel-header .count { font-weight: 400; color: #a89880; }
  
  .editor { flex: 1; padding: 16px; font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; line-height: 1.8; border: none; resize: none; outline: none; background: white; color: #3d2e22; }
  .preview { flex: 1; padding: 24px 32px; overflow-y: auto; background: white; line-height: 1.9; font-size: 15px; }
  .divider { width: 1px; background: #e8e0d5; }
  
  /* ë§ˆí¬ë‹¤ìš´ ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼ */
  .preview h1 { font-size: 28px; font-weight: 800; margin: 24px 0 16px; color: #3d2e22; border-bottom: 2px solid #d4a853; padding-bottom: 8px; }
  .preview h2 { font-size: 22px; font-weight: 700; margin: 20px 0 12px; color: #544339; }
  .preview h3 { font-size: 18px; font-weight: 600; margin: 16px 0 8px; color: #6b5744; }
  .preview p { margin: 10px 0; }
  .preview strong { color: #7c3aed; font-weight: 700; }
  .preview em { color: #d97706; font-style: italic; }
  .preview code { background: #f3ede4; padding: 2px 6px; border-radius: 4px; font-family: 'Consolas', monospace; font-size: 13px; color: #c4943f; }
  .preview pre { background: #2d2d2d; color: #f8f8f2; padding: 16px; border-radius: 8px; overflow-x: auto; margin: 12px 0; }
  .preview pre code { background: none; color: inherit; padding: 0; }
  .preview blockquote { border-left: 4px solid #d4a853; padding: 12px 16px; margin: 12px 0; background: #faf6ee; color: #6b5744; border-radius: 0 8px 8px 0; }
  .preview ul, .preview ol { padding-left: 24px; margin: 10px 0; }
  .preview li { margin: 4px 0; }
  .preview a { color: #3b82f6; text-decoration: underline; }
  .preview hr { border: none; border-top: 1px solid #e8e0d5; margin: 20px 0; }
  .preview table { border-collapse: collapse; width: 100%; margin: 12px 0; }
  .preview th, .preview td { border: 1px solid #e8e0d5; padding: 8px 12px; text-align: left; }
  .preview th { background: #f3ede4; font-weight: 600; }
  .preview img { max-width: 100%; border-radius: 8px; }
  
  /* ë¡œê·¸ */
  .log { background: #faf5ff; border-top: 1px solid #e9d5ff; padding: 8px 24px; font-size: 12px; color: #7c3aed; max-height: 100px; overflow-y: auto; }
  .log .item { padding: 2px 0; }
  .log .success { color: #10b981; }
  .log .info { color: #6b7280; }
  
  /* ë³µì‚¬ ì™„ë£Œ í† ìŠ¤íŠ¸ */
  .toast { position: fixed; top: 20px; right: 20px; background: #10b981; color: white; padding: 12px 24px; border-radius: 8px; font-weight: 600; opacity: 0; transition: opacity 0.3s; z-index: 100; }
  .toast.show { opacity: 1; }
</style>
</head>
<body>

<div class="header">
  <h1>âœï¸ ë§ˆí¬ë‹¤ìš´ ì—ë””í„° â€” ë¶€ìíƒ€ì„</h1>
  <span class="badge">ì œë¯¸ë‚˜ì´ ë‹µë³€ â†’ ê¹”ë”í•œ ë§ˆí¬ë‹¤ìš´</span>
</div>

<div class="toolbar">
  <button class="btn btn-paste" onclick="pasteFromClipboard()">ğŸ“‹ ë¶™ì—¬ë„£ê¸°</button>
  <button class="btn btn-fix" onclick="autoFix()">ğŸ”§ ìë™ ìˆ˜ì •</button>
  <button class="btn btn-preview" onclick="togglePreview()">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</button>
  <button class="btn btn-copy" onclick="copyResult()">ğŸ“‘ ë³µì‚¬í•˜ê¸°</button>
  <button class="btn btn-clear" onclick="clearAll()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
</div>

<div class="main">
  <div class="panel" id="editorPanel">
    <div class="panel-header">
      <span>ğŸ“ ë§ˆí¬ë‹¤ìš´ ì…ë ¥ (ì œë¯¸ë‚˜ì´ ë‹µë³€ ë¶™ì—¬ë„£ê¸°)</span>
      <span class="count" id="charCount">0ì</span>
    </div>
    <textarea class="editor" id="editor" placeholder="ì—¬ê¸°ì— ì œë¯¸ë‚˜ì´ ë‹µë³€ì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”...

Ctrl+Vë¡œ ë¶™ì—¬ë„£ê¸° â†’ ğŸ”§ ìë™ ìˆ˜ì • â†’ ğŸ“‘ ë³µì‚¬í•˜ê¸°

íŠ¹ìˆ˜ë¬¸ì ì˜¤ë¥˜ê°€ ìë™ìœ¼ë¡œ êµì •ë©ë‹ˆë‹¤!"></textarea>
  </div>
  <div class="divider"></div>
  <div class="panel" id="previewPanel" style="display:none;">
    <div class="panel-header">
      <span>ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</span>
      <span class="count" id="previewInfo"></span>
    </div>
    <div class="preview" id="preview"></div>
  </div>
</div>

<div class="log" id="log" style="display:none;"></div>
<div class="toast" id="toast"></div>

<script>
const editor = document.getElementById('editor');
const preview = document.getElementById('preview');
const log = document.getElementById('log');
const charCount = document.getElementById('charCount');

editor.addEventListener('input', () => {
  charCount.textContent = editor.value.length.toLocaleString() + 'ì';
});

// ========== ìë™ ìˆ˜ì • (fix_markdown.py í¬íŒ…) ==========
function fixMarkdown(text) {
  const changes = [];
  let result = text;

  // íŒ¨í„´ 1: **[text]] â†’ **[text]**
  result = result.replace(/\*\*(\[[^\]]+\])\]/g, (m, p1) => {
    changes.push('ëŒ€ê´„í˜¸ ]] ë‹«ê¸° â†’ ]** ìˆ˜ì •');
    return `**${p1}**`;
  });

  // íŒ¨í„´ 1b: **í…ìŠ¤íŠ¸[ì„¤ëª…]] â†’ **í…ìŠ¤íŠ¸[ì„¤ëª…]**
  result = result.replace(/\*\*([^*\n]+\[[^\]]+\])\]/g, (m, p1) => {
    changes.push('ë³µí•© ëŒ€ê´„í˜¸ ìˆ˜ì •');
    return `**${p1}**`;
  });

  // íŒ¨í„´ 2: **[text]* â†’ **[text]**
  result = result.replace(/\*\*(\[[^\]]+\])\*(?!\*)/g, (m, p1) => {
    changes.push('"*" í•˜ë‚˜ë¡œ ë‹«ê¸° â†’ ** ìˆ˜ì •');
    return `**${p1}**`;
  });

  // íŒ¨í„´ 5b: **(text)) â†’ **(text)**
  result = result.replace(/\*\*(\([^)]+\))\)/g, (m, p1) => {
    changes.push('ì†Œê´„í˜¸ )) â†’ )** ìˆ˜ì •');
    return `**${p1}**`;
  });

  // íŒ¨í„´ 5c: **(text)* â†’ **(text)**
  result = result.replace(/\*\*(\([^)]+\))\*(?!\*)/g, (m, p1) => {
    changes.push('ì†Œê´„í˜¸ ")*" â†’ )** ìˆ˜ì •');
    return `**${p1}**`;
  });

  // íŒ¨í„´ 5d: **í…ìŠ¤íŠ¸(ì„¤ëª…)) â†’ **í…ìŠ¤íŠ¸(ì„¤ëª…)**
  result = result.replace(/\*\*([^*\n]+\([^)]+\))\)/g, (m, p1) => {
    changes.push('ë³µí•© ì†Œê´„í˜¸ ìˆ˜ì •');
    return `**${p1}**`;
  });

  // íŒ¨í„´ 3: **í…ìŠ¤íŠ¸ (ë³¼ë“œ ì•ˆ ë‹«í˜)
  const lines = result.split('\n');
  for (let i = 0; i < lines.length; i++) {
    const s = lines[i].trim();
    if (s.startsWith('**') && !s.startsWith('***') && (s.match(/\*\*/g) || []).length === 1 && s.length < 200) {
      changes.push('ë³¼ë“œ ì•ˆ ë‹«í˜ ìˆ˜ì •: ' + s.slice(0, 30) + '...');
      lines[i] = lines[i].trimEnd() + '**';
    }
  }
  result = lines.join('\n');

  // íŒ¨í„´ 4,5: ë°±í‹± ë¶ˆì¼ì¹˜
  const b4 = result;
  result = result.replace(/(?<!`)``(?!`)(.*?)(?<!`)`(?!`)/g, '`$1`');
  result = result.replace(/(?<!`)`(?!`)(.*?)(?<!`)``(?!`)/g, '`$1`');
  if (result !== b4) changes.push('ë°±í‹± ê°œìˆ˜ ë¶ˆì¼ì¹˜ ìˆ˜ì •');

  // íŒ¨í„´ 6: ##ì œëª© â†’ ## ì œëª©
  let inCode = false;
  const lines2 = result.split('\n');
  for (let i = 0; i < lines2.length; i++) {
    if (lines2[i].trim().startsWith('```')) { inCode = !inCode; continue; }
    if (inCode) continue;
    const m = lines2[i].match(/^(#{1,6})([^\s#])/);
    if (m) {
      changes.push('# ë’¤ ê³µë°± ì¶”ê°€');
      lines2[i] = m[1] + ' ' + lines2[i].slice(m[1].length);
    }
  }
  result = lines2.join('\n');

  // íŒ¨í„´ 7: -í•­ëª© â†’ - í•­ëª©
  inCode = false;
  const lines3 = result.split('\n');
  for (let i = 0; i < lines3.length; i++) {
    if (lines3[i].trim().startsWith('```')) { inCode = !inCode; continue; }
    if (inCode) continue;
    const m = lines3[i].match(/^(\s*)-([^\s\-\d])/);
    if (m) {
      changes.push('- ë’¤ ê³µë°± ì¶”ê°€');
      lines3[i] = m[1] + '- ' + lines3[i].slice(m[1].length + 1);
    }
  }
  result = lines3.join('\n');

  return { fixed: result, changes };
}

// ========== ê°„ë‹¨í•œ ë§ˆí¬ë‹¤ìš´ â†’ HTML ë³€í™˜ ==========
function mdToHtml(md) {
  let html = md;
  // ì½”ë“œë¸”ë¡
  html = html.replace(/```(\w*)\n([\s\S]*?)```/g, '<pre><code>$2</code></pre>');
  // í…Œì´ë¸”
  html = html.replace(/^\|(.+)\|\s*\n\|[-| :]+\|\s*\n((?:\|.+\|\s*\n?)*)/gm, (match, header, body) => {
    const ths = header.split('|').map(h => `<th>${h.trim()}</th>`).join('');
    const rows = body.trim().split('\n').map(row => {
      const tds = row.replace(/^\||\|$/g, '').split('|').map(c => `<td>${c.trim()}</td>`).join('');
      return `<tr>${tds}</tr>`;
    }).join('');
    return `<table><thead><tr>${ths}</tr></thead><tbody>${rows}</tbody></table>`;
  });
  // ì œëª©
  html = html.replace(/^######\s+(.+)$/gm, '<h6>$1</h6>');
  html = html.replace(/^#####\s+(.+)$/gm, '<h5>$1</h5>');
  html = html.replace(/^####\s+(.+)$/gm, '<h4>$1</h4>');
  html = html.replace(/^###\s+(.+)$/gm, '<h3>$1</h3>');
  html = html.replace(/^##\s+(.+)$/gm, '<h2>$1</h2>');
  html = html.replace(/^#\s+(.+)$/gm, '<h1>$1</h1>');
  // ì¸ìš©
  html = html.replace(/^>\s+(.+)$/gm, '<blockquote>$1</blockquote>');
  // êµ¬ë¶„ì„ 
  html = html.replace(/^---$/gm, '<hr>');
  // ë³¼ë“œ/ì´íƒ¤ë¦­
  html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
  html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
  html = html.replace(/\*(.+?)\*/g, '<em>$1</em>');
  // ì¸ë¼ì¸ ì½”ë“œ
  html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
  // ë§í¬
  html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank">$1</a>');
  // ì´ë¯¸ì§€
  html = html.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<img src="$2" alt="$1">');
  // ëª©ë¡
  html = html.replace(/^\* (.+)$/gm, '<li>$1</li>');
  html = html.replace(/^- (.+)$/gm, '<li>$1</li>');
  html = html.replace(/^(\d+)\. (.+)$/gm, '<li>$2</li>');
  // ì—°ì† lië¥¼ ulë¡œ ê°ì‹¸ê¸°
  html = html.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');
  // ì¤„ë°”ê¿ˆ â†’ p
  html = html.replace(/\n\n/g, '</p><p>');
  html = '<p>' + html + '</p>';
  html = html.replace(/<p>\s*<(h[1-6]|ul|ol|pre|blockquote|table|hr)/g, '<$1');
  html = html.replace(/<\/(h[1-6]|ul|ol|pre|blockquote|table)>\s*<\/p>/g, '</$1>');
  html = html.replace(/<p>\s*<\/p>/g, '');
  html = html.replace(/<p><hr><\/p>/g, '<hr>');
  return html;
}

// ========== ë²„íŠ¼ ê¸°ëŠ¥ ==========
function autoFix() {
  const { fixed, changes } = fixMarkdown(editor.value);
  editor.value = fixed;
  charCount.textContent = fixed.length.toLocaleString() + 'ì';
  
  log.style.display = 'block';
  if (changes.length === 0) {
    log.innerHTML = '<div class="item success">âœ… ìˆ˜ì •í•  ì˜¤ë¥˜ê°€ ì—†ìŠµë‹ˆë‹¤! ê¹”ë”í•œ ë§ˆí¬ë‹¤ìš´ì…ë‹ˆë‹¤.</div>';
  } else {
    log.innerHTML = `<div class="item" style="font-weight:600;">ğŸ”§ ${changes.length}ê±´ ìë™ ìˆ˜ì • ì™„ë£Œ!</div>` +
      changes.map(c => `<div class="item">â€¢ ${c}</div>`).join('');
  }
  
  // ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
  if (document.getElementById('previewPanel').style.display !== 'none') {
    updatePreview();
  }
}

function togglePreview() {
  const pp = document.getElementById('previewPanel');
  if (pp.style.display === 'none') {
    pp.style.display = 'flex';
    updatePreview();
  } else {
    pp.style.display = 'none';
  }
}

function updatePreview() {
  preview.innerHTML = mdToHtml(editor.value);
  document.getElementById('previewInfo').textContent = 'ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°';
}

function copyResult() {
  navigator.clipboard.writeText(editor.value).then(() => {
    showToast('ğŸ“‘ ë³µì‚¬ ì™„ë£Œ! ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”');
  });
}

async function pasteFromClipboard() {
  try {
    const text = await navigator.clipboard.readText();
    editor.value = text;
    charCount.textContent = text.length.toLocaleString() + 'ì';
    showToast('ğŸ“‹ ë¶™ì—¬ë„£ê¸° ì™„ë£Œ!');
  } catch {
    showToast('âš ï¸ í´ë¦½ë³´ë“œ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤');
  }
}

function clearAll() {
  if (editor.value && !confirm('ì „ì²´ ë‚´ìš©ì„ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  editor.value = '';
  preview.innerHTML = '';
  log.style.display = 'none';
  charCount.textContent = '0ì';
}

function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2000);
}

// ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
editor.addEventListener('input', () => {
  if (document.getElementById('previewPanel').style.display !== 'none') {
    updatePreview();
  }
});

// ë‹¨ì¶•í‚¤
document.addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.key === 's') { e.preventDefault(); autoFix(); }       // Ctrl+S = ìë™ìˆ˜ì •
  if (e.ctrlKey && e.shiftKey && e.key === 'C') { e.preventDefault(); copyResult(); }  // Ctrl+Shift+C = ë³µì‚¬
});
</script>
</body>
</html>
